/**
 * mc-video-thumbnail v0.1.0 ()
 * Copyright 2015 Jesse Ocon
 * Licensed under MIT
 */
"use strict";angular.module("mcVideoThumbnailSettings",[]).provider("mcVideoThumbnailSettings",function(){var e,n={max_thumbnails:10,thumbnail_interval:1e3},i=function(){return e||(e=angular.copy(n)),e};return this.set=function(e,n){var t=i();return angular.isObject(e)?angular.extend(t,e):t[e]=n,this},this.$get=i,this}),function(e,n,i){n.module("mcVideoThumbnailDirective",[]).directive("mcVideoThumbnail",["$timeout","mcVideoThumbnailSettings",function(e,n){return{restrict:"E",transclude:!0,scope:{close:"&onClose",onCreatedThumb:"&",onCreatedThumbs:"&",stopper:"=stopper"},template:'<canvas id="mc-thumbnailer-canvas"></canvas><ng-transclude></ng-transclude>',link:function(t,d){var o,a,u,r,m,c,l,s,h=d.find("canvas")[0],v=d.find("video")[0],f=d.find("video").find("source")[0],g=h.getContext("2d"),b=n.max_thumbnails,V=n.thumbnail_interval;t.$on("mc.thumbnailer.stop",function(e,n){l()}),t.video=d.find("video")[0],t.dummyVideo=i,t.thumbs=[],t.intervalID=i,a=function(e){h.width=e.videoWidth,h.height=e.videoHeight},o=function(e){var n;return g.drawImage(e,0,0,e.videoWidth,e.videoHeight),n=h.toDataURL("image/png"),t.$apply(function(){t.thumbs.push({data:n})}),n},c=function(e){var n,i=1;t.intervalID=setInterval(function(){i>=b&&l(),n=o(e),t.onCreatedThumb({img:n}),i++},V)},l=function(){clearInterval(t.intervalID),s()},s=function(){d[0].removeChild(t.dummyVideo),t.dummyVideo=null},r=function(){c(t.dummyVideo)},m=function(){l(t.intervalID)},u=function(e){a(e.currentTarget),t.dummyVideo=e.currentTarget.cloneNode(!0),d.append(t.dummyVideo),t.dummyVideo.muted=!0,t.dummyVideo.style.display="none",t.dummyVideo.addEventListener("loadeddata",r),t.dummyVideo.addEventListener("ended",m),t.dummyVideo.load(),t.dummyVideo.play()},t.init=function(){e(function(){v.addEventListener("loadeddata",function(e){this.play(),this.pause(),u(e)}),f.addEventListener("error",function(e){console.log("there was an error loading the video: ",e)}),v.addEventListener("error",function(){console.log("the video errored out")})},0,!1)},t.init()}}}])}(window,window.angular),function(e,n,i){n.module("mcVideoThumbnail",["mcVideoThumbnailDirective","mcVideoThumbnailSettings"])}(window,window.angular);